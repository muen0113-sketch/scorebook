{% extends 'base.html' %}
{% block title %}æˆç¸¾è¨˜éŒ„æœ¬ Â· {{ d.strftime('%Y-%m-%d') }}{% endblock %}

{% block content %}
<div class="layout">
  <!-- å·¦ï¼šä¸»å€åŸŸ -->
  <section class="main">
    <!-- Topï¼šæœˆ/æ—¥é¸æ“‡ + ä»Šå¤©è³‡è¨Š -->
    <div class="toolbar">
      <div class="month-picker">
        <label>æœˆä»½ï¼š</label>
        <input type="month" value="{{ first_day.strftime('%Y-%m') }}" onchange="gotoMonth(this)">
        <a class="btn" href="{{ url_for('scores_view', d=prev_month.strftime('%Y-%m-%d')) }}">â—€ ä¸Šå€‹æœˆ</a>
        <a class="btn" href="{{ url_for('scores_view', d=next_month.strftime('%Y-%m-%d')) }}">ä¸‹å€‹æœˆ â–¶</a>
      </div>
      <div class="day-picker">
        <label>æ—¥æœŸï¼š</label>
        <input type="date" value="{{ d.strftime('%Y-%m-%d') }}" onchange="gotoDate(this)">
        <span class="muted">ä»Šå¤©æ˜¯ï¼š{{ d.strftime('%Y-%m-%d') }}ï¼ˆé€±{{ weekday }}ï¼‰</span>
      </div>
    </div>

    <!-- Middleï¼šåˆ†æ•¸è¡¨å–® -->
    <form method="post" action="{{ url_for('save_scores') }}" class="card">
      <input type="hidden" name="the_date" value="{{ d.strftime('%Y-%m-%d') }}">
      <table class="grid">
        <thead>
          <tr>
            <th style="width: 24%">ç§‘ç›®</th>
            <th style="width: 18%">åˆ†æ•¸</th>
            <th style="width: 18%">åæ¬¡</th>
            <th style="width: 28%">å‚™è¨»</th>
            <th style="width: 12%">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {% for subj in subjects %}
            {% set row = scores_map.get(subj.id) %}
            <tr>
              <td><strong>{{ subj.name }}</strong></td>
              <td>
                <input type="hidden" name="score_subject_ids" value="{{ subj.id }}">
                <input type="number" name="score[{{ subj.id }}]" step="0.01" min="0" placeholder="e.g. 88" value="{{ row.score if row else '' }}">
              </td>
              <td>
                <input type="number" name="rank[{{ subj.id }}]" min="1" step="1" placeholder="e.g. 3" value="{{ row.rank if row else '' }}">
              </td>
              <td>
                <input type="text" name="note[{{ subj.id }}]" maxlength="200" placeholder="ä¾‹å¦‚ï¼šéŒ¯åœ¨æ¦‚ç‡é¡Œï¼›ä¸‹æ¬¡åŠ å¼·å¹¾ä½•" value="{{ row.note if row else '' }}">
              </td>
              <td>
                <form method="post" action="{{ url_for('delete_subject', sid=subj.id) }}" onsubmit="return confirm('ç¢ºå®šåˆªé™¤ç§‘ç›®ï¼š{{ subj.name }}ï¼Ÿæ­¤æ“ä½œæœƒåˆªé™¤æ‰€æœ‰ç›¸é—œç´€éŒ„ã€‚')">
                  <button type="submit" class="btn danger">åˆªé™¤ç§‘ç›®</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="actions">
        <button class="btn primary" type="submit">ğŸ’¾ å„²å­˜ç•¶æ—¥ç´€éŒ„</button>
        <a class="btn" target="_blank" href="{{ url_for('export_pdf', d=d.strftime('%Y-%m-%d')) }}">ğŸ–¨ï¸ åŒ¯å‡ºç•¶æ—¥ PDF</a>
        <span class="muted">ï¼ˆå…¨éƒ¨ç•™ç©ºï¼åˆªé™¤è©²ç§‘çš„ç•¶æ—¥ç´€éŒ„ï¼‰</span>
      </div>
    </form>
  </section>

  <!-- å³ï¼šå´é‚Šæ¬„ï¼ˆæ–°å¢/åˆªé™¤ç§‘ç›®ï¼‰ -->
  <aside class="sidebar">
    <div class="card">
      <h3>æ–°å¢ç§‘ç›®</h3>
      <form method="post" action="{{ url_for('add_subject') }}" class="vert">
        <input type="text" name="name" placeholder="ä¾‹å¦‚ï¼šç†åŒ–ã€åœ°ç†" required>
        <button type="submit" class="btn">â• æ–°å¢</button>
      </form>
      <p class="muted">åˆªé™¤ç§‘ç›®å¯åœ¨å·¦å´è¡¨æ ¼ä¸­æ“ä½œã€‚</p>
    </div>
  </aside>
</div>
{% endblock %}
